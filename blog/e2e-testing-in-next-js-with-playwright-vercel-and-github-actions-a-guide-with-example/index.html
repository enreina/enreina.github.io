<!DOCTYPE html>
<html lang="en">
<head>

    <title>E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        :root {
            --button-bg-color: #ffffff;
            --button-text-color: var(--color-darkgrey);
        }
    </style>

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=64dab6371e" />

    <meta name="description" content="A guide on setting up and writing E2E tests for a Next.js app using Playwright. Based on hands-on experience." />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <link rel="canonical" href="https://enreina.com/blog/e2e-testing-in-next-js-with-playwright-vercel-and-github-actions-a-guide-with-example/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="Enreina" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience" />
    <meta property="og:description" content="A guide on setting up and writing E2E tests for a Next.js app using Playwright. Based on hands-on experience." />
    <meta property="og:url" content="https://enreina.com/blog/e2e-testing-in-next-js-with-playwright-vercel-and-github-actions-a-guide-with-example/" />
    <meta property="og:image" content="https://enreina.com/content/images/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png" />
    <meta property="article:published_time" content="2023-01-06T12:30:13.000Z" />
    <meta property="article:modified_time" content="2023-01-06T23:46:31.000Z" />
    <meta property="article:tag" content="Web Development" />
    <meta property="article:tag" content="Software Engineering" />
    
    <meta property="article:publisher" content="https://www.facebook.com/ghost" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience" />
    <meta name="twitter:description" content="A guide on setting up and writing E2E tests for a Next.js app using Playwright. Based on hands-on experience." />
    <meta name="twitter:url" content="https://enreina.com/blog/e2e-testing-in-next-js-with-playwright-vercel-and-github-actions-a-guide-with-example/" />
    <meta name="twitter:image" content="https://enreina.com/content/images/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Enreina" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Web Development, Software Engineering" />
    <meta name="twitter:site" content="@ghost" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1080" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Enreina",
        "url": "https://enreina.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://enreina.com/favicon.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Enreina",
        "image": {
            "@type": "ImageObject",
            "url": "https://enreina.com/content/images/2022/04/IMG_4699.png",
            "width": 120,
            "height": 120
        },
        "url": "https://enreina.com/author/enreina/",
        "sameAs": []
    },
    "headline": "E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience",
    "url": "https://enreina.com/blog/e2e-testing-in-next-js-with-playwright-vercel-and-github-actions-a-guide-with-example/",
    "datePublished": "2023-01-06T12:30:13.000Z",
    "dateModified": "2023-01-06T23:46:31.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://enreina.com/content/images/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png",
        "width": 1920,
        "height": 1080
    },
    "keywords": "Web Development, Software Engineering",
    "description": "A guide on setting up and writing E2E tests for a Next.js app using Playwright. Based on hands-on experience.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://enreina.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.41" />
    <link rel="alternate" type="application/rss+xml" title="Enreina" href="https://enreina.com/blog/rss/" />
    
    <script defer src="/public/cards.min.js?v=64dab6371e"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=64dab6371e">
    <style type='text/css'>
    /* Hide the Membership aka Subscribe actions etc. */
    #ghost-portal-root,
    a[href^="https://ghost.org"],
    a[href^="#/portal/signup"],
    .gh-social-facebook,
    .gh-social-twitter,
    .footer-cta { display: none; }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" integrity="sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg==" crossorigin="anonymous" referrerpolicy="no-referrer" /><style>:root {--ghost-accent-color: #0d527d;}</style>

</head>
<body class="post-template tag-web-development tag-software-engineering">
<div class="viewport">

    <header id="gh-head" class="gh-head has-cover">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="https://enreina.com">
                        Enreina
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://enreina.com/">Home</a></li>
    <li class="nav-projects"><a href="https://enreina.com/projects/">Projects</a></li>
    <li class="nav-blog nav-current-parent"><a href="https://enreina.com/blog/">Blog</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                        <a class="gh-social-facebook" href="https://www.facebook.com/ghost" title="Facebook" target="_blank" rel="noopener"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 0c8.837 0 16 7.163 16 16s-7.163 16-16 16S0 24.837 0 16 7.163 0 16 0zm5.204 4.911h-3.546c-2.103 0-4.443.885-4.443 3.934.01 1.062 0 2.08 0 3.225h-2.433v3.872h2.509v11.147h4.61v-11.22h3.042l.275-3.81h-3.397s.007-1.695 0-2.187c0-1.205 1.253-1.136 1.329-1.136h2.054V4.911z" /></svg></a>
                        <a class="gh-social-twitter" href="https://twitter.com/ghost" title="Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
                </div>

                    <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
    <article class="article post tag-web-development tag-software-engineering featured ">

        <header class="article-header gh-canvas">

            <section class="article-tag">
                <a href="https://enreina.com/tag/web-development/">Web Development</a>
            </section>

            <h1 class="article-title">E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience</h1>

            <p class="article-excerpt">A guide on setting up and writing E2E tests for a Next.js app using Playwright. Based on hands-on experience.</p>

            <div class="article-byline">
                <section class="article-byline-content">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <a href="/author/enreina/" class="author-avatar">
                                <img class="author-profile-image" src="/content/images/size/w100/2022/04/IMG_4699.png" alt="Enreina" />
                            </a>
                        </li>
                    </ul>
                    <div class="article-byline-meta">
                        <h4 class="author-name"><a href="/author/enreina/">Enreina</a></h4>
                        <div class="byline-meta-content">
                            <time class="byline-meta-date" datetime="2023-01-06">Jan 6, 2023</time>
                            <span class="byline-reading-time"><span class="bull">&bull;</span> 10 min read</span>
                        </div>
                    </div>
                </section>
            </div>

            <figure class="article-image">
                <img
                    srcset="/content/images/size/w300/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png 300w,
                            /content/images/size/w600/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png 600w,
                            /content/images/size/w1000/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png 1000w,
                            /content/images/size/w2000/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="/content/images/size/w2000/2023/01/Featured-Image---Blog-Post---E2E-Testing-1.png"
                    alt="E2E Testing in Next.js with Playwright, Vercel, and GitHub Actions: A Guide Based on Experience"
                />
            </figure>
        </header>

        <section class="gh-content gh-canvas">
            <p>I have just spent 2 days ‚Äî around 4 hours each day ‚Äî setting up end-to-end (E2E) tests for my Next.js app. I have had a fair share of experience setting up E2E tests for previous projects, with different tech stacks and frameworks, but setting up this kind of test has never been straightforward. Thus, I‚Äôm writing this blog post for the future me whenever she sets up yet another project and would like to set up E2E tests again. Although the post format would be a mix between a tutorial and learnings from my experience, I hope this post could be beneficial for you (yes, <em>you </em>as the one who‚Äôs currently reading this post).</p><p><strong>Table of Contents</strong></p><!--kg-card-begin: html--><div class="hc-toc"></div><!--kg-card-end: html--><h2 id="why-do-i-need-e2e-tests">Why do I need E2E Tests?</h2><p>When developing software, writing tests is a means to catch a bug whenever new code is introduced to the code base. There are several types of tests one can set up for a software project ‚Äî unit, integration, and end-to-end testing.</p><p>I had this notion before that writing test is being responsible for your own code, but honestly, I had been putting off writing any test for my project (more about the project below) because it hinders the momentum that drives me to deliver the end product.</p><p>Now that the web app has reached beyond its MVP state, and I‚Äôm planning on doing a bit of backend migration ‚Äî I think this is the right time to introduce tests. And I happen to just pick the integrating E2E test for now for my Next.js app.</p><h2 id="about-the-project-used-in-this-guide">About The Project Used in This Guide</h2><p>So, I‚Äôve been developing a simple web app for my Japanese learning journey called <em>Ichi Bun Zutsu</em>. It‚Äôs a web app that simply shows one Japanese sentence at a time for reading practice. The learner can then check their understanding of the sentence by showing the English translation of the sentence. The project was initiated mainly for me to learn Next.js and Typescript. It‚Äôs available here: <a href="https://ichibunzutsu.vercel.app/">the web app</a> and the <a href="https://github.com/enreina/ichibunzutsu">source code</a>.</p><p>Although I‚Äôll be using this project to describe the step-by-step process of setting up E2E testing, you should (hopefully) be able to follow along with any Next.js app.</p><hr><p>There are several Javascript library options we can use for writing the test ‚Äî the most known are Puppeteer (usually with Jest), Cypress, and Playwright. I had had a fair share of experience before both with Puppeteer and Jest, thus for learning purposes I picked up <a href="https://playwright.dev/">Playwright</a> this time.</p><h2 id="setting-up-playwright">Setting up Playwright</h2><p>To setup Playwright with Next.js, if we‚Äôre starting a new project we can use the <a href="https://github.com/vercel/next.js/tree/canary/examples/with-playwright">with-playwright</a> sample app provided by Next.js and use it with <code>create-next-app</code> :</p><pre><code class="language-bash">npx create-next-app@latest --example with-playwright with-playwright-app</code></pre><p>But in my case (and maybe yours too), I already have an existing Next.js app and would like to add Playwright. We can do the <a href="https://nextjs.org/docs/testing#manual-setup-1" rel="noopener noreferrer">manual setup</a> described in the Next.js documentation, but I prefer the way described in the <a href="https://playwright.dev/docs/intro#installing-playwright" rel="noopener noreferrer">Playwright documentation</a>:</p><pre><code class="language-bash">yarn create playwright
# or npm init playwright@latest</code></pre><p>You‚Äôll be prompted with the following questions to choose how you'd like to set up Playwright:</p><pre><code class="language-bash">‚úî Where to put your end-to-end tests? ¬∑ tests/e2e
‚úî Add a GitHub Actions workflow? (y/N) ¬∑ true
‚úî Install Playwright browsers (can be done manually via 'yarn playwright install')? (Y/n) ‚Ä∫ true</code></pre><p>The GitHub Actions workflow is set to false by default, so if you‚Äôre planning to run the tests as CI using GitHub Actions, I recommend setting this to true so the playwright can generate the workflow YAML file as well. We'll modify the YAML file later in this guide.</p><p>After the setup these directories and files should have been added:</p><pre><code class="language-bash">.github
‚îî‚îÄ‚îÄ workflows
    ‚îî‚îÄ‚îÄ playwright.yml
tests-examples
‚îî‚îÄ‚îÄ demo-todo-app.spec.ts
tests/
‚îî‚îÄ‚îÄ e2e
    ‚îî‚îÄ‚îÄ example.spec.ts
playwright.config.ts</code></pre><p>Now you can try running the test examples by running:</p><pre><code class="language-bash">yarn playwright test</code></pre><p>And the tests should pass, and we can even see the report by running:</p><pre><code class="language-bash">npx playwright show-report</code></pre><p>I also added <code>"test:e2e": "playwright test"</code> to my <code>package.json</code> scripts field for convenience's sake, so tests could be run with this command as well:</p><pre><code class="language-bash">yarn test:e2e</code></pre><p>Now, let‚Äôs make some adjustments to the Playwright configuration file ‚Äî playwright.config.ts. The full config is available <a href="https://github.com/enreina/ichibunzutsu/blob/main/playwright.config.ts" rel="noopener noreferrer">here</a>, but the important additions are the following:</p><pre><code class="language-TypeScript">// playwright.config.ts
const PORT = process.env.PORT || 3000;
const BASE_URL = process.env.BASE_URL || `http://localhost:${PORT}`;

const config: PlaywrightTestConfig = {
	...
	use: {
		...,
		baseURL: BASE_URL,
	},
	webServer: {
    command: `yarn dev`,
    url: BASE_URL,
    timeout: 120 * 1000,
    reuseExistingServer: !process.env.CI,
  },
	...,
}</code></pre><p>By adding the <code>baseUrl</code> config, we can omit the full URL when writing the tests and only provide the route. The <code>webServer</code> configuration, on the other hand, is for Playwright to automatically run the local dev server before starting the tests. For more detail on Playwright configuration options, please refer to their <a href="https://playwright.dev/docs/test-configuration" rel="noopener noreferrer">test configuration documentation</a>.</p><p>Now that we‚Äôve finished setting up Playwright, you can poke around the provided test examples ‚Äî the one in the tests-examples is a more detailed example test for a todo app. Once you‚Äôve finished exploring, let‚Äôs remove them from our repo:</p><pre><code class="language-bash">rm tests/e2e/example.spec.ts
rm -R tests-examples</code></pre><p>Now, let‚Äôs get going on writing our own test.</p><h2 id="writing-tests">Writing Tests</h2><p>Let us create a test for our index page:</p><pre><code class="language-bash">touch tests/e2e/index.spec.ts</code></pre><p>Let‚Äôs start with a simple test. For my web app, the index page would be redirected to the <code>/settings</code> modal for first-time visitors. So I‚Äôd like to assert in the test that the redirection happens. Here‚Äôs the short test:</p><pre><code class="language-TypeScript">// tests/e2e/index.spec.ts
import { test, expect } from '@playwright/test';

test('homepage redirects to /settings', async ({ page }) =&gt; {
    await page.goto('/'); // remember -- we don't have to provide full URL as we already set baseUrl in playwright config file
    await expect(page).toHaveURL('/settings');
});</code></pre><p>Alright, let‚Äôs try running the test using the command, <code>yarn test:e2e</code> and it <em>should</em> pass.</p><p>Now let‚Äôs expand this test so to be more ‚Äúend-to-end‚Äù to cover the following user interactions (you may want to try the <a href="https://ichibunzutsu.vercel.app">web app</a> to understand the flow better):</p><ol><li>The user clicks the <code>SAVE SETTINGS</code> button</li><li>After loading, the user should see a Japanese sentence with a <code>SHOW ENGLISH</code> button below it</li><li>The user clicks the ¬†<code>SHOW ENGLISH</code> button, and should see the English sentence counterpart</li></ol><p>Simple enough? Well, let‚Äôs try writing the test:</p><pre><code class="language-TypeScript">import { test, expect } from '@playwright/test';

test('index page shows a japanese sentence and a button to show the english translation', async ({ page }) =&gt; {
    await page.goto('/');
    await expect(page).toHaveURL('/settings');
    await page.getByRole('button', { name: 'Save Settings' }).click(); 
    await expect(page.getByTestId('japanese-sentence')).not.toBeEmpty();
    await page.getByRole('button', { name: 'Show English' }).click();
    await expect(page.getByTestId('english-sentence')).not.toBeEmpty(); 
});</code></pre><p>Playwright provides several ways to locate elements through their <a href="https://playwright.dev/docs/locators">Locator API</a> ‚Äî please check the documentation to find the one that suits your needs. Here, I‚Äôm relying on using two types of locators:</p><ul><li><a href="https://playwright.dev/docs/locators#locate-by-role">getByRole</a> to locate the <code>Save Settings</code> and <code>Show English</code> button</li><li><a href="https://playwright.dev/docs/locators#locate-by-test-id">getByTestID</a> to locate the Japanese and English sentence</li></ul><p>On that note, when using <code>getByTestID</code> we would need to add <code>data-testid</code> attribute to the elements, for example on <code>pages/index.tsx</code> in my project:</p><pre><code class="language-TypeScript">// pages/index.tsx
...
&lt;Typography data-testid="japanese-sentence" component="h1" variant="h4" align="center"&gt;
   &lt;JapaneseSentenceElement sentence={sentence} /&gt;
&lt;/Typography&gt;
...
&lt;Typography data-testid="english-sentence" variant="h5" align="center"&gt;
   {sentence['en']}
&lt;/Typography&gt;
...</code></pre><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text"><strong>TIPS</strong>: Use Playwright‚Äôs Test Generator<br>Instead of manually writing the test, we can also use Playwright‚Äôs test generator to write the code for us. First, run the web app on your local machine in a different terminal:<br><code>yarn dev # or npm run dev</code><br>then run the codegen:<br><code>npx playwright codegen localhost:3000</code><br>See <a href="https://playwright.dev/docs/codegen-intro" rel="noopener noreferrer">Test Generator documentation</a> for more details.</div></div><p>Alright, let‚Äôs run the test ‚Äî run <code>yarn test:e2e</code> and the test should pass.</p><h2 id="setting-up-ci-using-github-actions">Setting up CI using GitHub Actions</h2><p>By using <code>yarn create playwright</code> earlier and opting for GitHub Actions workflow to be added, one might expect that we can just push this to GitHub and the CI should run and tests should pass. It did pass when we ran it locally, right?</p><p>So let‚Äôs try it, commit the files and push the changes to GitHub:</p><pre><code class="language-bash">git add .
git commit -m "chore: set up E2E test using playwright"
git push --set-upstream origin playwright-playground # branch name</code></pre><p>Now, in order to trigger the CI job, what should we do? Let‚Äôs check the <code>.github/workflows/playwright.yaml</code> file that Playwright has created for us, and you should see this section:</p><pre><code class="language-YAML">...
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
...</code></pre><p>It means the job will be triggered either on a push or a pull-request to the <code>main</code> branch. So let‚Äôs try creating a pull request by visiting <code>[your-github-repo-url]/pull/new/[branch-name]</code>. In my case: <a href="https://github.com/enreina/ichibunzutsu/pull/new/playwright-playground" rel="noopener noreferrer">https://github.com/enreina/ichibunzutsu/pull/new/playwright-playground</a>. Choose <code>Create pull request</code> , and after the Pull-Request (PR) is created, you should see the Playwright tests workflow running. You can click the <code>Details</code> link to see the logs.</p><figure class="kg-card kg-image-card"><img src="https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-15.47.31.png" class="kg-image" alt loading="lazy" width="923" height="317" srcset="https://enreina.com/content/images/size/w600/2023/01/Screen-Shot-2023-01-06-at-15.47.31.png 600w, https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-15.47.31.png 923w" sizes="(min-width: 720px) 720px"></figure><p>And‚Ä¶ in the case that the test fails (which it did), the logs should show something like this:</p><figure class="kg-card kg-image-card"><img src="https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-15.58.24.png" class="kg-image" alt loading="lazy" width="950" height="500" srcset="https://enreina.com/content/images/size/w600/2023/01/Screen-Shot-2023-01-06-at-15.58.24.png 600w, https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-15.58.24.png 950w" sizes="(min-width: 720px) 720px"></figure><p>Alright, let‚Äôs think a bit. The test had passed on my local machine so why did it fail on GitHub Actions? The answer: <strong>Environment Variables</strong>.</p><p>In order for the web app to work and be able to fetch data from the API, I need to set an API Key as an environment variable. For local development, I set my API key in the <code>.env.local</code> file, which generally should not be committed to Git. I need to set the following variables in order for the web app to work:</p><figure class="kg-card kg-code-card"><pre><code class="language-bash">SHEETSON_API_KEY=some_api_key
SHEETSON_SPREADSHEET_ID=some_spreadsheet_id</code></pre><figcaption><em>(What‚Äôs ‚ÄúSheetson‚Äù? Please check it out <a href="https://sheetson.com/" rel="noopener noreferrer">here</a>.)</em></figcaption></figure><p>In our case right now, we run a ‚Äúlocal‚Äù deployment on the GitHub Actions server, but we never let GitHub know the values of the necessary variables. So we‚Äôd need a way to pass them without publishing them on the repo itself.</p><p>Another preferred option is to run the test against a ‚Äúpreview‚Äù deployment, so we won‚Äôt need to run the app on the CI job itself. In this case, the environment variables should be set up on whichever deployment platform you‚Äôre using. In this post, as I‚Äôm using <a href="https://vercel.com/">Vercel</a> to host my app, I‚Äôll describe the way to run the test against Vercel‚Äôs preview deployment.</p><h3 id="option-1-run-tests-against-localhost-on-github-actions-server">Option 1: Run tests against localhost (on GitHub Actions server)</h3><p>Let‚Äôs first try the first option to run the app on the CI job. We first need to store the environment variables as <a href="https://www.google.com/search?q=github+secrets&amp;oq=github+secrets&amp;aqs=chrome..69i57j0i512l4j69i60l3.6185j0j7&amp;sourceid=chrome&amp;ie=UTF-8">Actions secrets</a>. Basically:</p><ol><li>Go to the <code>Settings</code> tab of your GitHub Repo</li><li>Click on <code>Secrets &gt; Actions</code> under the Security section</li><li>Click on the <code>New repository secret</code> button and fill in the variable name and value</li></ol><p>If you need multiple variables set up, simply repeat the steps. In my case I added two secrets to my project:</p><figure class="kg-card kg-image-card"><img src="https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-16.12.20.png" class="kg-image" alt loading="lazy" width="807" height="229" srcset="https://enreina.com/content/images/size/w600/2023/01/Screen-Shot-2023-01-06-at-16.12.20.png 600w, https://enreina.com/content/images/2023/01/Screen-Shot-2023-01-06-at-16.12.20.png 807w" sizes="(min-width: 720px) 720px"></figure><p>Then, we‚Äôd need to pass these secrets to the workflow by modifying the <code>playwright.yaml</code> file. In the step named <code>Run Playwright tests</code> , add the variables in the <code>env</code> field:</p><pre><code class="language-YAML">...
- name: Run Playwright tests
  run: yarn playwright test
  env:
    SHEETSON_API_KEY: ${{ secrets.SHEETSON_API_KEY }}
    SHEETSON_SPREADSHEET_ID: ${{ secrets.SHEETSON_SPREADSHEET_ID }}
...</code></pre><p>Commit and push the change. Again, let‚Äôs check the logs of the workflow on GitHub Actions. After a few minutes ‚Äî voila üéâ ¬†the test passes!</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text"><strong>TIPS</strong>: Make sure that the variable name is <strong>spelled correctly</strong> across all codebase, configuration files, as well on GitHub secrets.<br><br>I had spent a few hours trying to figure out why my test was still failing because I set the variable as <code>SHEETSON_SPREAD<strong>S</strong>HEET_ID</code> on the <code>.yaml</code> file, but as <code>SHEETSON_SPREADHEET_ID</code> everywhere else.</div></div><h3 id="option-2-run-tests-against-vercel-preview-deployment">Option 2: Run tests against Vercel Preview Deployment</h3><p>Okay, now let‚Äôs try on the second option to run the tests against a Vercel Preview deployment. I personally prefer this option as I already have a Vercel setup for my preview and production deployment, and it would be ideal to have a testing environment as similar as possible to the production environment (which is what preview deployments are for).</p><p>I‚Äôd assume you also already have Vercel setup for your project ‚Äî if you haven‚Äôt, worry not, as it‚Äôs very straightforward moreover for a Next.js app. You can check the quickstart guide <a href="https://vercel.com/docs#quickstart">here</a>.</p><p>Now, the idea is to wait for Vercel‚Äôs preview deployment to be completed, and then we would use the preview URL to run our Playwright tests against. We‚Äôll be using a premade Github Action, <code>patrickedqvist/wait-for-vercel-preview@v1.2.0</code> (<a href="https://github.com/patrickedqvist/wait-for-vercel-preview">repo link</a>) to achieve this. Let‚Äôs update our <code>playwright.yaml</code>, by inserting this as the first step of the workflow:</p><pre><code class="language-yaml">...
steps:
  - name: Waiting for 200 from the Vercel Preview
    uses: patrickedqvist/wait-for-vercel-preview@v1.2.0 # &lt;https://github.com/patrickedqvist/wait-for-vercel-preview&gt;
    id: waitForDeploy
    with:
      token: ${{ secrets.GITHUB_TOKEN }}
      max_timeout: 300
  ...
</code></pre><p>Also, we‚Äôd need to use the outputted preview URL as the base URL for our playwright tests. Let‚Äôs set this as <code>env</code> in the <code>Run playwright tests</code> step:</p><pre><code class="language-yaml">...
- name: Run Playwright tests
  run: yarn playwright test
  env:
    BASE_URL: ${{ steps.waitForDeploy.outputs.url }}
...
</code></pre><p>The full <code>playwright.yaml</code> for my project can be checked out <a href="https://github.com/enreina/ichibunzutsu/blob/main/.github/workflows/playwright.yml">here</a>.</p><p>Also, let‚Äôs modify our <code>webServer</code> field in our <code>playwright.config.ts</code>:</p><pre><code class="language-tsx">...
webServer: process.env.CI ? undefined : {
    command: `yarn dev`,
    url: BASE_URL,
    timeout: 120 * 1000,
    reuseExistingServer: true,
},
...
</code></pre><p>This way, when we run the tests on our local machine, the local dev server would still be started. ¬†Though, on GitHub Actions, we don‚Äôt need it to be run as the tests would instead be run against the preview URL from Vercel.</p><p>Alright, let‚Äôs commit and push the changes. Then, check the logs on the PR ‚Äî and if nothing is broken (e.g. Vercel Deployment fails), the test should pass.</p><p>Now we have our E2E tests and CI set up, and we can merge the change to the <code>main</code> branch, which you can do through the <code>Merge pull request</code> option on your GitHub PR.</p><hr><h2 id="summary">Summary</h2><p>I hope the experience/guide I shared above would be beneficial for anyone who wants to start writing E2E tests for their Next.js app. I believe Playwright provides a good example of a testing library that makes it easy to incorporate into our project. It would generate necessary starting sample tests, configuration files, and even a GitHub workflow setup. Of course, we‚Äôd need to adjust them to suit our needs.</p><p>In the post, I described my experience of setting up E2E tests and the overall process are:</p><ol><li>Integrating the testing library (in this case <strong>Playwright</strong>)</li><li>Writing the tests</li><li>Run the tests locally</li><li>Setup the tests to run on a CI environment (in this case <strong>GitHub Actions</strong>)</li><li>[optional] Set to run the tests against a preview deployment (in this case from <strong>Vercel</strong>)</li></ol><p>And ‚Äî that‚Äôs it!</p>
        </section>


    </article>
</main>


    <section class="footer-cta ">
        <div class="inner">
            <h2>Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>




            <aside class="read-more-wrap">
                <div class="read-more inner">
                        
<article class="post-card post featured ">

    <a class="post-card-image-link" href="/blog/a-year-of-retrospective-2022/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2022/12/Frame-1--2-.png 300w,
                    /content/images/size/w600/2022/12/Frame-1--2-.png 600w,
                    /content/images/size/w1000/2022/12/Frame-1--2-.png 1000w,
                    /content/images/size/w2000/2022/12/Frame-1--2-.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2022/12/Frame-1--2-.png"
            alt="A campfire"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/blog/a-year-of-retrospective-2022/">
            <header class="post-card-header">
                <h2 class="post-card-title">A Year of Retrospective, 2022</h2>
            </header>
            <div class="post-card-excerpt">
                <p>The end of the year is the time when content with the theme ‚Äú2022 Review‚Äù spawns everywhere in many kinds of forms: from articles, blog posts (like what you‚Äôre reading right now), Instagram highlights, and Spotify Wrapped, to anything we can think of. While I am not someone who</p>
            </div>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/enreina/" class="static-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2022/04/IMG_4699.png" alt="Enreina" loading="lazy" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span class="post-card-byline-author"><a href="/author/enreina/">Enreina</a></span>
                <span class="post-card-byline-date"><time datetime="2022-12-30">Dec 30, 2022</time> <span class="bull">&bull;</span> 6 min read</span>
            </div>
        </footer>

    </div>

</article>
                        
<article class="post-card post featured ">

    <a class="post-card-image-link" href="/blog/book-review-mata-onaji-yume-wo-miteita/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2022/10/IMG_2675.jpg 300w,
                    /content/images/size/w600/2022/10/IMG_2675.jpg 600w,
                    /content/images/size/w1000/2022/10/IMG_2675.jpg 1000w,
                    /content/images/size/w2000/2022/10/IMG_2675.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2022/10/IMG_2675.jpg"
            alt="A Book Review: Mata, Onaji Yume wo Miteita"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/blog/book-review-mata-onaji-yume-wo-miteita/">
            <header class="post-card-header">
                <h2 class="post-card-title">A Book Review: Mata, Onaji Yume wo Miteita</h2>
            </header>
            <div class="post-card-excerpt">
                <p>After passing the JLPT N3 last July (yay!), I decided to further improve my reading level by consuming more Japanese literature. This novel ‚Äî „Åæ„Åü„ÄÅÂêå„ÅòÂ§¢„ÇíË¶ã„Å¶„ÅÑ„Åü (I Saw the Same Dream Again) by ‰ΩèÈáé„Çà„Çã (Sumino Yoru) ‚Äî is the first Japanese novel I managed to finish reading. When I say a Japanese</p>
            </div>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/enreina/" class="static-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2022/04/IMG_4699.png" alt="Enreina" loading="lazy" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span class="post-card-byline-author"><a href="/author/enreina/">Enreina</a></span>
                <span class="post-card-byline-date"><time datetime="2022-10-03">Oct 3, 2022</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>
                        
<article class="post-card post ">

    <a class="post-card-image-link" href="/blog/how-i-build-a-habit-to-level-up-my-japanese-and-passed-the-jlpt-n3/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2022/08/image9738-1.png 300w,
                    /content/images/size/w600/2022/08/image9738-1.png 600w,
                    /content/images/size/w1000/2022/08/image9738-1.png 1000w,
                    /content/images/size/w2000/2022/08/image9738-1.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2022/08/image9738-1.png"
            alt="How I Build a Habit to Level up My Japanese (and Passed the JLPT N3)"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/blog/how-i-build-a-habit-to-level-up-my-japanese-and-passed-the-jlpt-n3/">
            <header class="post-card-header">
                <h2 class="post-card-title">How I Build a Habit to Level up My Japanese (and Passed the JLPT N3)</h2>
            </header>
            <div class="post-card-excerpt">
                <p>One of the things I have had in mind to do in my career break is to improve my Japanese. My current Japanese level is very vague. I passed the JLPT N4 (equivalent to the upper elementary level, or A2/B1 in CEFR level) in 2016 ‚Äî but since then I</p>
            </div>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/enreina/" class="static-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2022/04/IMG_4699.png" alt="Enreina" loading="lazy" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span class="post-card-byline-author"><a href="/author/enreina/">Enreina</a></span>
                <span class="post-card-byline-date"><time datetime="2022-08-27">Aug 27, 2022</time> <span class="bull">&bull;</span> 10 min read</span>
            </div>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://enreina.com">Enreina</a> &copy; 2023</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=64dab6371e"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>

<script>
tocbot.init({
// Where to render the table of contents.
tocSelector: '.hc-toc',
// Where to grab the headings to build the table of contents.
contentSelector: '.gh-content',
// Which headings to grab inside of the contentSelector element.
headingSelector: 'h1, h2, h3, h4, h5, h6' ,
// For headings inside relative or absolute positioned containers within content.
hasInnerContainers: true,
});
</script>

</body>
</html>
